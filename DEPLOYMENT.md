# üöÄ RishtaConnect - Complete Deployment Guide

This guide provides step-by-step instructions to deploy RishtaConnect (Frontend + Backend) on various platforms.

---

## üìã Table of Contents

1. [Prerequisites](#prerequisites)
2. [Deployment Options](#deployment-options)
3. [Option 1: Frontend (Netlify) + Backend (Render)](#option-1-frontend-netlify--backend-render-recommended)
4. [Option 2: Both on Render](#option-2-both-on-render)
5. [Database Setup](#database-setup)
6. [Environment Variables](#environment-variables)
7. [Post-Deployment](#post-deployment)
8. [Troubleshooting](#troubleshooting)

---

## Prerequisites

Before deploying, ensure you have:

- ‚úÖ GitHub account with your code pushed
- ‚úÖ Netlify account (for frontend)
- ‚úÖ Render account (for backend/database)
- ‚úÖ Domain name (optional, for custom domains)

---

## Deployment Options

### **Option 1: Frontend (Netlify) + Backend (Render)** ‚≠ê Recommended
- **Pros:** Best performance, automatic SSL, global CDN for frontend
- **Cons:** Managing two platforms

### **Option 2: Both on Render**
- **Pros:** Single platform, easier management
- **Cons:** Static site hosting might be slower than Netlify CDN

---

## Option 1: Frontend (Netlify) + Backend (Render) [Recommended]

### Step 1: Deploy Backend on Render

#### 1.1 Create MySQL Database

1. **Login to Render**
   - Go to https://dashboard.render.com/
   - Sign up/Login with GitHub

2. **Create New MySQL Database**
   - Click **"New +"** ‚Üí **"MySQL"**
   - Fill in details:
     ```
     Name: rishtaconnect-db
     Database: rishtaconnect_db
     User: rishtaconnect_user
     Region: Choose nearest to your users (e.g., Singapore, Oregon)
     MySQL Version: 8.0
     ```
   - Choose **Free** tier (or paid for production)
   - Click **"Create Database"**

3. **Save Connection Details**
   After creation, you'll see:
   ```
   Internal Database URL: mysql://user:pass@hostname:3306/dbname
   External Database URL: mysql://user:pass@hostname:3306/dbname
   Hostname: dpg-xxxxx.oregon-postgres.render.com
   Port: 3306
   Database: rishtaconnect_db
   Username: rishtaconnect_user
   Password: <auto-generated>
   ```
   
   **‚ö†Ô∏è IMPORTANT:** Save these credentials securely!

#### 1.2 Deploy Backend Service

1. **Create Web Service**
   - Click **"New +"** ‚Üí **"Web Service"**
   - Choose **"Build and deploy from a Git repository"**
   - Click **"Connect GitHub"** and authorize
   - Select repository: `RishtaConnect`

2. **Configure Service**
   ```
   Name: rishtaconnect-backend
   Region: Same as database (e.g., Oregon)
   Branch: main
   Root Directory: RishtaConnect-backend
   Runtime: Java
   Build Command: ./mvnw clean install -DskipTests
   Start Command: java -Dspring.profiles.active=prod -Dserver.port=$PORT -jar target/*.jar
   Instance Type: Free (or paid)
   ```

3. **Advanced Settings**
   - Auto-Deploy: Yes
   - Health Check Path: `/actuator/health` (if you have Spring Actuator)

4. **Environment Variables**
   
   Click **"Environment"** tab and add these variables:

   | Key | Value | Example |
   |-----|-------|---------|
   | `DATABASE_URL` | Your MySQL connection URL | `jdbc:mysql://dpg-xxxxx:3306/rishtaconnect_db` |
   | `DB_USERNAME` | Database username | `rishtaconnect_user` |
   | `DB_PASSWORD` | Database password | `<your-password>` |
   | `JWT_SECRET_KEY` | Random 256-bit secret | `843567893696976453275974432697R6349...` |
   | `FRONTEND_URL` | Your Netlify URL (add later) | `https://rishtaconnect.netlify.app` |
   | `BASE_URL` | Your backend URL | `https://rishtaconnect-backend.onrender.com` |
   | `SPRING_PROFILES_ACTIVE` | `prod` | `prod` |
   | `UPLOAD_DIR` | `/opt/render/project/src/uploads/gallery` | `/opt/render/project/src/uploads/gallery` |

   **Generate JWT Secret Key:**
   ```bash
   # Use this command or any random 256-bit string
   openssl rand -base64 64
   ```

5. **Deploy**
   - Click **"Create Web Service"**
   - Wait for build (5-10 minutes)
   - Check logs for any errors
   - Note your backend URL: `https://rishtaconnect-backend.onrender.com`

#### 1.3 Verify Backend

1. **Test Health Endpoint**
   ```bash
   curl https://rishtaconnect-backend.onrender.com/api/auth/test
   ```

2. **Check Logs**
   - Go to Render Dashboard ‚Üí Your Service ‚Üí Logs
   - Look for "Started BackendMatrilabApplication"

---

### Step 2: Deploy Frontend on Netlify

#### 2.1 Prepare Frontend

1. **Update Environment File**
   
   Edit `RishtaConnect-frontend/.env.production`:
   ```env
   NODE_ENV=production
   REACT_APP_API_URL=https://rishtaconnect-backend.onrender.com
   REACT_APP_ENABLE_CONSOLE_LOGS=false
   GENERATE_SOURCEMAP=false
   ```

2. **Commit and Push**
   ```bash
   git add .
   git commit -m "chore: update production API URL"
   git push origin main
   ```

#### 2.2 Deploy on Netlify

1. **Login to Netlify**
   - Go to https://www.netlify.com/
   - Sign up/Login with GitHub

2. **Create New Site**
   - Click **"Add new site"** ‚Üí **"Import an existing project"**
   - Choose **"GitHub"**
   - Authorize Netlify to access your repos
   - Select `RishtaConnect` repository

3. **Configure Build Settings**
   ```
   Base directory: RishtaConnect-frontend
   Build command: npm run build
   Publish directory: RishtaConnect-frontend/build
   ```

4. **Environment Variables**
   
   Click **"Show advanced"** ‚Üí **"New variable"**:
   
   | Key | Value |
   |-----|-------|
   | `REACT_APP_API_URL` | `https://rishtaconnect-backend.onrender.com` |
   | `NODE_ENV` | `production` |
   | `GENERATE_SOURCEMAP` | `false` |
   | `NODE_VERSION` | `18` |

5. **Deploy Site**
   - Click **"Deploy site"**
   - Wait for build (2-5 minutes)
   - Your site will be live at: `https://random-name-12345.netlify.app`

6. **Custom Domain (Optional)**
   - Go to **Site settings** ‚Üí **Domain management**
   - Click **"Add custom domain"**
   - Enter your domain: `rishtaconnect.com`
   - Follow DNS configuration steps
   - SSL certificate will be auto-generated

#### 2.3 Update Backend CORS

1. **Update Backend Environment Variable**
   - Go to Render Dashboard ‚Üí Backend Service ‚Üí Environment
   - Update `FRONTEND_URL`:
     ```
     FRONTEND_URL=https://rishtaconnect.netlify.app
     ```
   - Save changes (service will auto-redeploy)

#### 2.4 Verify Frontend

1. Open your Netlify URL
2. Try to register a new user
3. Login and test features
4. Check browser console for errors

---

## Option 2: Both on Render

### Step 1: Deploy Backend

Follow same steps as [Option 1 - Step 1](#step-1-deploy-backend-on-render)

### Step 2: Deploy Frontend on Render

#### 2.1 Create Static Site

1. **New Static Site**
   - Click **"New +"** ‚Üí **"Static Site"**
   - Connect GitHub repository

2. **Configure**
   ```
   Name: rishtaconnect-frontend
   Branch: main
   Root Directory: RishtaConnect-frontend
   Build Command: npm run build
   Publish Directory: build
   ```

3. **Environment Variables**
   ```
   REACT_APP_API_URL=https://rishtaconnect-backend.onrender.com
   NODE_VERSION=18
   GENERATE_SOURCEMAP=false
   ```

4. **Deploy**
   - Click **"Create Static Site"**
   - Wait for build

#### 2.2 Configure Redirects

Create `RishtaConnect-frontend/public/_redirects`:
```
/*    /index.html   200
```

---

## Database Setup

### Manual Database Initialization (If Needed)

If Hibernate doesn't auto-create tables:

1. **Connect to Database**
   ```bash
   mysql -h <hostname> -u <username> -p
   ```

2. **Run Migrations**
   ```sql
   USE rishtaconnect_db;
   
   -- Tables will be created automatically by Hibernate
   -- But if you need to manually create support_tickets:
   
   CREATE TABLE IF NOT EXISTS support_tickets (
       id BIGINT NOT NULL AUTO_INCREMENT,
       user_id BIGINT NOT NULL,
       subject VARCHAR(200) NOT NULL,
       description TEXT NOT NULL,
       status VARCHAR(20) NOT NULL DEFAULT 'OPEN',
       priority VARCHAR(20) DEFAULT 'MEDIUM',
       category VARCHAR(50) DEFAULT 'OTHER',
       created_date DATETIME,
       updated_date DATETIME,
       resolved_date DATETIME,
       PRIMARY KEY (id),
       CONSTRAINT fk_support_tickets_user 
           FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
   ```

---

## Environment Variables

### Backend Environment Variables (Render)

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | MySQL connection string | `jdbc:mysql://dpg-xxx:3306/db` |
| `DB_USERNAME` | Database user | `rishtaconnect_user` |
| `DB_PASSWORD` | Database password | `securePassword123` |
| `JWT_SECRET_KEY` | JWT signing key (256-bit min) | `your_256_bit_secret` |
| `FRONTEND_URL` | Frontend URL for CORS | `https://app.netlify.app` |
| `BASE_URL` | Backend base URL | `https://api.onrender.com` |
| `SPRING_PROFILES_ACTIVE` | Spring profile | `prod` |
| `UPLOAD_DIR` | File upload directory | `/opt/render/project/src/uploads/gallery` |

### Frontend Environment Variables (Netlify)

| Variable | Description | Example |
|----------|-------------|---------|
| `REACT_APP_API_URL` | Backend API URL | `https://api.onrender.com` |
| `NODE_ENV` | Environment | `production` |
| `GENERATE_SOURCEMAP` | Generate source maps | `false` |
| `NODE_VERSION` | Node.js version | `18` |

---

## Post-Deployment

### 1. Test Complete Flow

- [ ] Registration works
- [ ] Login works
- [ ] Profile update works
- [ ] Image upload works
- [ ] Search functionality works
- [ ] Messaging works
- [ ] Interest requests work

### 2. Monitor Logs

**Backend (Render):**
- Go to Dashboard ‚Üí Service ‚Üí Logs
- Watch for errors

**Frontend (Netlify):**
- Go to Dashboard ‚Üí Site ‚Üí Deploys ‚Üí Deploy log
- Check browser console on live site

### 3. Set Up Custom Domains

**Frontend (Netlify):**
```
1. Buy domain from Namecheap/GoDaddy
2. Add to Netlify: Site settings ‚Üí Domain management
3. Update DNS records:
   - Type: A, Name: @, Value: 75.2.60.5
   - Type: CNAME, Name: www, Value: your-site.netlify.app
```

**Backend (Render):**
```
1. Go to Service ‚Üí Settings ‚Üí Custom Domain
2. Add your API domain: api.yourdomain.com
3. Update DNS:
   - Type: CNAME, Name: api, Value: your-service.onrender.com
```

### 4. Enable HTTPS

- **Netlify:** Auto-enabled (Let's Encrypt)
- **Render:** Auto-enabled for custom domains

### 5. Performance Optimization

**Frontend:**
- Enable Netlify CDN (automatic)
- Add `netlify.toml` optimizations (already added)
- Consider image optimization

**Backend:**
- Upgrade to paid plan for 24/7 uptime (free tier sleeps after 15min inactivity)
- Add caching where appropriate
- Monitor database queries

---

## Troubleshooting

### Issue 1: Backend Returns 502 Bad Gateway

**Causes:**
- Build failed
- Application crashed on startup
- Port not correctly configured

**Solution:**
```bash
# Check Render logs
# Ensure start command uses: -Dserver.port=$PORT
# Verify all environment variables are set
```

### Issue 2: CORS Errors

**Symptoms:**
```
Access to XMLHttpRequest has been blocked by CORS policy
```

**Solution:**
1. Check `FRONTEND_URL` in backend environment variables
2. Ensure it matches your Netlify URL exactly (no trailing slash)
3. Redeploy backend after changing

### Issue 3: Database Connection Failed

**Error:**
```
Unable to create connection to database server
```

**Solution:**
1. Verify `DATABASE_URL` format:
   ```
   jdbc:mysql://hostname:3306/database_name
   ```
2. Check `DB_USERNAME` and `DB_PASSWORD`
3. Ensure database is running (check Render DB dashboard)

### Issue 4: JWT Token Invalid

**Error:**
```
JWT signature does not match
```

**Solution:**
1. Ensure `JWT_SECRET_KEY` is same across deployments
2. Minimum 256-bit length required
3. Clear browser localStorage and login again

### Issue 5: File Upload Fails

**Error:**
```
Failed to upload image
```

**Solution:**
1. Check `UPLOAD_DIR` environment variable
2. Verify directory permissions
3. For Render, use: `/opt/render/project/src/uploads/gallery`
4. Consider using cloud storage (AWS S3, Cloudinary) for production

### Issue 6: Frontend Shows Old Content

**Solution:**
```bash
# Clear Netlify cache
1. Netlify Dashboard ‚Üí Deploys
2. Click "Clear cache and deploy site"

# Or trigger new deploy
git commit --allow-empty -m "chore: trigger deploy"
git push origin main
```

### Issue 7: Backend Sleeps (Free Tier)

**Issue:**
- Render free tier services sleep after 15 minutes of inactivity
- First request after sleep takes 30-60 seconds

**Solution:**
1. Upgrade to paid plan ($7/month) for 24/7 uptime
2. Or use a ping service (UptimeRobot) to keep it awake
3. Show loading state in frontend for slow first requests

---

## Monitoring & Maintenance

### 1. Set Up Uptime Monitoring

Use **UptimeRobot** (free):
```
1. Create account at uptimerobot.com
2. Add monitor:
   - Type: HTTP(s)
   - URL: https://your-backend.onrender.com/api/health
   - Interval: 5 minutes
3. Get alerts via email/SMS
```

### 2. Regular Backups

**Database (Render):**
- Free tier: No automatic backups
- Paid tier: Daily backups included
- Manual: Export via MySQL dump

```bash
mysqldump -h hostname -u username -p database_name > backup.sql
```

### 3. Log Monitoring

- Check logs daily for errors
- Set up log aggregation (Logtail, Papertrail)
- Monitor error rates

### 4. Performance Monitoring

- Google Analytics for frontend
- Render metrics for backend
- Database query performance

---

## Cost Estimation

### Free Tier (Development/Testing)

| Service | Cost | Limitations |
|---------|------|-------------|
| Netlify | Free | 100GB bandwidth/month |
| Render Backend | Free | Sleeps after 15min, 750 hours/month |
| Render Database | Free | 1GB storage, expires after 90 days |
| **Total** | **$0/month** | Limited |

### Production Tier

| Service | Cost | Features |
|---------|------|----------|
| Netlify Pro | $19/month | Unlimited bandwidth, advanced features |
| Render Backend | $7/month | 24/7 uptime, 512MB RAM |
| Render Database | $7/month | 1GB storage, backups |
| Domain | $10-15/year | Custom domain |
| **Total** | **~$35/month** | Production-ready |

---

## Next Steps

1. ‚úÖ Deploy backend on Render
2. ‚úÖ Deploy frontend on Netlify
3. ‚úÖ Test all features
4. ‚úÖ Set up custom domains
5. ‚úÖ Enable monitoring
6. ‚úÖ Set up backups
7. ‚úÖ Consider upgrading to paid tiers for production

---

## Support

If you face any issues:

1. Check [Troubleshooting](#troubleshooting) section
2. Review deployment logs
3. Check GitHub Issues
4. Contact support@sonnentechs.com

---

**Happy Deploying! üöÄ**

*Last Updated: November 2025*
