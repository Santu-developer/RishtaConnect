# Render Blueprint for RishtaConnect
# This file allows you to deploy both frontend and backend on Render
# Documentation: https://render.com/docs/blueprint-spec

services:
  # Backend Service (Spring Boot)
  - type: web
    name: rishtaconnect-backend
    runtime: java
    region: oregon # Change to your preferred region
    plan: free # Change to 'starter' ($7/month) for production
    branch: main
    rootDir: RishtaConnect-backend
    buildCommand: ./mvnw clean install -DskipTests
    startCommand: java -Dspring.profiles.active=prod -Dserver.port=$PORT -jar target/*.jar
    healthCheckPath: /api/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: DATABASE_URL
        fromDatabase:
          name: rishtaconnect-db
          property: connectionString
      - key: DB_USERNAME
        fromDatabase:
          name: rishtaconnect-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: rishtaconnect-db
          property: password
      - key: JWT_SECRET_KEY
        generateValue: true # Auto-generate secure random value
      - key: FRONTEND_URL
        value: https://rishtaconnect.netlify.app # Update with your Netlify URL
      - key: BASE_URL
        sync: false # Set this manually to your backend URL
      - key: UPLOAD_DIR
        value: /opt/render/project/src/uploads/gallery

  # Frontend Service (React) - Optional if deploying on Render
  # Comment out if using Netlify
  # - type: web
  #   name: rishtaconnect-frontend
  #   runtime: static
  #   region: oregon
  #   plan: free
  #   branch: main
  #   rootDir: RishtaConnect-frontend
  #   buildCommand: npm install && npm run build
  #   staticPublishPath: build
  #   envVars:
  #     - key: REACT_APP_API_URL
  #       value: https://rishtaconnect-backend.onrender.com
  #     - key: NODE_VERSION
  #       value: 18
  #     - key: GENERATE_SOURCEMAP
  #       value: false
  #   routes:
  #     - type: rewrite
  #       source: /*
  #       destination: /index.html

databases:
  # MySQL Database
  - name: rishtaconnect-db
    databaseName: rishtaconnect_db
    user: rishtaconnect_user
    region: oregon # Same region as backend for better performance
    plan: free # Change to 'starter' for production
    ipAllowList: [] # Empty = allow all IPs
